{"version":3,"sources":["/var/www/htdocs/github.timshomepage.net/animeclient/frontEndSrc/js/sw.js","/var/www/htdocs/github.timshomepage.net/animeclient/frontEndSrc/js/anime-client.js","/var/www/htdocs/github.timshomepage.net/animeclient/frontEndSrc/js/events.js","/var/www/htdocs/github.timshomepage.net/animeclient/frontEndSrc/js/session-check.js","/var/www/htdocs/github.timshomepage.net/animeclient/frontEndSrc/js/template-helpers.js","/var/www/htdocs/github.timshomepage.net/animeclient/frontEndSrc/js/fns.js","/var/www/htdocs/github.timshomepage.net/animeclient/frontEndSrc/js/anime.js","/var/www/htdocs/github.timshomepage.net/animeclient/frontEndSrc/js/manga.js"],"sourcesContent":["// Start the service worker, if you can\nif ('serviceWorker' in navigator) {\n\tnavigator.serviceWorker.register('/sw.js').then(reg => {\n\t\tconsole.log('Service worker registered', reg.scope);\n\t}).catch(error => {\n\t\tconsole.error('Failed to register service worker', error);\n\t});\n}","// -------------------------------------------------------------------------\n// ! Base\n// -------------------------------------------------------------------------\n\nconst matches = (elm, selector) => {\n\tlet m = (elm.document || elm.ownerDocument).querySelectorAll(selector);\n\tlet i = matches.length;\n\twhile (--i >= 0 && m.item(i) !== elm) {};\n\treturn i > -1;\n}\n\nconst AnimeClient = {\n\t/**\n\t * Placeholder function\n\t */\n\tnoop: () => {},\n\t/**\n\t * DOM selector\n\t *\n\t * @param {string} selector - The dom selector string\n\t * @param {Element} [context]\n\t * @return array of dom elements\n\t */\n\t$(selector, context = null) {\n\t\tif (typeof selector !== 'string') {\n\t\t\treturn selector;\n\t\t}\n\n\t\tcontext = (context !== null && context.nodeType === 1)\n\t\t\t? context\n\t\t\t: document;\n\n\t\tlet elements = [];\n\t\tif (selector.match(/^#([\\w]+$)/)) {\n\t\t\telements.push(document.getElementById(selector.split('#')[1]));\n\t\t} else {\n\t\t\telements = [].slice.apply(context.querySelectorAll(selector));\n\t\t}\n\n\t\treturn elements;\n\t},\n\t/**\n\t * Does the selector exist on the current page?\n\t *\n\t * @param {string} selector\n\t * @returns {boolean}\n\t */\n\thasElement (selector) {\n\t\treturn AnimeClient.$(selector).length > 0;\n\t},\n\t/**\n\t * Scroll to the top of the Page\n\t *\n\t * @return {void}\n\t */\n\tscrollToTop () {\n\t\tconst el = AnimeClient.$('header')[0];\n\t\tel.scrollIntoView(true);\n\t},\n\t/**\n\t * Hide the selected element\n\t *\n\t * @param  {string|Element|Element[]} sel - the selector of the element to hide\n\t * @return {void}\n\t */\n\thide (sel) {\n\t\tif (typeof sel === 'string') {\n\t\t\tsel = AnimeClient.$(sel);\n\t\t}\n\n\t\tif (Array.isArray(sel)) {\n\t\t\tsel.forEach(el => el.setAttribute('hidden', 'hidden'));\n\t\t} else {\n\t\t\tsel.setAttribute('hidden', 'hidden');\n\t\t}\n\t},\n\t/**\n\t * UnHide the selected element\n\t *\n\t * @param  {string|Element|Element[]} sel - the selector of the element to hide\n\t * @return {void}\n\t */\n\tshow (sel) {\n\t\tif (typeof sel === 'string') {\n\t\t\tsel = AnimeClient.$(sel);\n\t\t}\n\n\t\tif (Array.isArray(sel)) {\n\t\t\tsel.forEach(el => el.removeAttribute('hidden'));\n\t\t} else {\n\t\t\tsel.removeAttribute('hidden');\n\t\t}\n\t},\n\t/**\n\t * Display a message box\n\t *\n\t * @param  {string} type - message type: info, error, success\n\t * @param  {string} message - the message itself\n\t * @return {void}\n\t */\n\tshowMessage (type, message) {\n\t\tlet template =\n\t\t\t`<div class='message ${type}'>\n\t\t\t\t<span class='icon'></span>\n\t\t\t\t${message}\n\t\t\t\t<span class='close'></span>\n\t\t\t</div>`;\n\n\t\tlet sel = AnimeClient.$('.message');\n\t\tif (sel[0] !== undefined) {\n\t\t\tsel[0].remove();\n\t\t}\n\n\t\tAnimeClient.$('header')[0].insertAdjacentHTML('beforeend', template);\n\t},\n\t/**\n\t * Finds the closest parent element matching the passed selector\n\t *\n\t * @param  {Element} current - the current Element\n\t * @param  {string} parentSelector - selector for the parent element\n\t * @return {Element|null} - the parent element\n\t */\n\tclosestParent (current, parentSelector) {\n\t\tif (Element.prototype.closest !== undefined) {\n\t\t\treturn current.closest(parentSelector);\n\t\t}\n\n\t\twhile (current !== document.documentElement) {\n\t\t\tif (matches(current, parentSelector)) {\n\t\t\t\treturn current;\n\t\t\t}\n\n\t\t\tcurrent = current.parentElement;\n\t\t}\n\n\t\treturn null;\n\t},\n\t/**\n\t * Generate a full url from a relative path\n\t *\n\t * @param  {string} path - url path\n\t * @return {string} - full url\n\t */\n\turl (path) {\n\t\tlet uri = `//${document.location.host}`;\n\t\turi += (path.charAt(0) === '/') ? path : `/${path}`;\n\n\t\treturn uri;\n\t},\n\t/**\n\t * Throttle execution of a function\n\t *\n\t * @see https://remysharp.com/2010/07/21/throttling-function-calls\n\t * @see https://jsfiddle.net/jonathansampson/m7G64/\n\t * @param {Number} interval - the minimum throttle time in ms\n\t * @param {Function} fn - the function to throttle\n\t * @param {Object} [scope] - the 'this' object for the function\n\t * @return {Function}\n\t */\n\tthrottle (interval, fn, scope) {\n\t\tlet wait = false;\n\t\treturn function (...args) {\n\t\t\tconst context = scope || this;\n\n\t\t\tif ( ! wait) {\n\t\t\t\tfn.apply(context, args);\n\t\t\t\twait = true;\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\twait = false;\n\t\t\t\t}, interval);\n\t\t\t}\n\t\t};\n\t},\n};\n\n// -------------------------------------------------------------------------\n// ! Events\n// -------------------------------------------------------------------------\n\nfunction addEvent(sel, event, listener) {\n\t// Recurse!\n\tif (! event.match(/^([\\w\\-]+)$/)) {\n\t\tevent.split(' ').forEach((evt) => {\n\t\t\taddEvent(sel, evt, listener);\n\t\t});\n\t}\n\n\tsel.addEventListener(event, listener, false);\n}\n\nfunction delegateEvent(sel, target, event, listener) {\n\t// Attach the listener to the parent\n\taddEvent(sel, event, (e) => {\n\t\t// Get live version of the target selector\n\t\tAnimeClient.$(target, sel).forEach((element) => {\n\t\t\tif(e.target == element) {\n\t\t\t\tlistener.call(element, e);\n\t\t\t\te.stopPropagation();\n\t\t\t}\n\t\t});\n\t});\n}\n\n/**\n * Add an event listener\n *\n * @param  {string|Element} sel - the parent selector to bind to\n * @param  {string} event - event name(s) to bind\n * @param  {string|Element|function} target - the element to directly bind the event to\n * @param  {function} [listener] - event listener callback\n * @return {void}\n */\nAnimeClient.on = (sel, event, target, listener) => {\n\tif (listener === undefined) {\n\t\tlistener = target;\n\t\tAnimeClient.$(sel).forEach((el) => {\n\t\t\taddEvent(el, event, listener);\n\t\t});\n\t} else {\n\t\tAnimeClient.$(sel).forEach((el) => {\n\t\t\tdelegateEvent(el, target, event, listener);\n\t\t});\n\t}\n};\n\n// -------------------------------------------------------------------------\n// ! Ajax\n// -------------------------------------------------------------------------\n\n/**\n * Url encoding for non-get requests\n *\n * @param data\n * @returns {string}\n * @private\n */\nfunction ajaxSerialize(data) {\n\tlet pairs = [];\n\n\tObject.keys(data).forEach((name) => {\n\t\tlet value = data[name].toString();\n\n\t\tname = encodeURIComponent(name);\n\t\tvalue = encodeURIComponent(value);\n\n\t\tpairs.push(`${name}=${value}`);\n\t});\n\n\treturn pairs.join('&');\n}\n\n/**\n * Make an ajax request\n *\n * Config:{\n * \tdata: // data to send with the request\n * \ttype: // http verb of the request, defaults to GET\n * \tsuccess: // success callback\n * \terror: // error callback\n * }\n *\n * @param  {string} url - the url to request\n * @param  {Object} config  - the configuration object\n * @return {XMLHttpRequest}\n */\nAnimeClient.ajax = (url, config) => {\n\t// Set some sane defaults\n\tconst defaultConfig = {\n\t\tdata: {},\n\t\ttype: 'GET',\n\t\tdataType: '',\n\t\tsuccess: AnimeClient.noop,\n\t\tmimeType: 'application/x-www-form-urlencoded',\n\t\terror: AnimeClient.noop\n\t}\n\n\tconfig = {\n\t\t...defaultConfig,\n\t\t...config,\n\t}\n\n\tlet request = new XMLHttpRequest();\n\tlet method = String(config.type).toUpperCase();\n\n\tif (method === 'GET') {\n\t\turl += (url.match(/\\?/))\n\t\t\t? ajaxSerialize(config.data)\n\t\t\t: `?${ajaxSerialize(config.data)}`;\n\t}\n\n\trequest.open(method, url);\n\n\trequest.onreadystatechange = () => {\n\t\tif (request.readyState === 4) {\n\t\t\tlet responseText = '';\n\n\t\t\tif (request.responseType === 'json') {\n\t\t\t\tresponseText = JSON.parse(request.responseText);\n\t\t\t} else {\n\t\t\t\tresponseText = request.responseText;\n\t\t\t}\n\n\t\t\tif (request.status > 299) {\n\t\t\t\tconfig.error.call(null, request.status, responseText, request.response);\n\t\t\t} else {\n\t\t\t\tconfig.success.call(null, responseText, request.status);\n\t\t\t}\n\t\t}\n\t};\n\n\tif (config.dataType === 'json') {\n\t\tconfig.data = JSON.stringify(config.data);\n\t\tconfig.mimeType = 'application/json';\n\t} else {\n\t\tconfig.data = ajaxSerialize(config.data);\n\t}\n\n\trequest.setRequestHeader('Content-Type', config.mimeType);\n\n\tif (method === 'GET') {\n\t\trequest.send(null);\n\t} else {\n\t\trequest.send(config.data);\n\t}\n\n\treturn request\n};\n\n/**\n * Do a get request\n *\n * @param {string} url\n * @param {object|function} data\n * @param {function} [callback]\n * @return {XMLHttpRequest}\n */\nAnimeClient.get = (url, data, callback = null) => {\n\tif (callback === null) {\n\t\tcallback = data;\n\t\tdata = {};\n\t}\n\n\treturn AnimeClient.ajax(url, {\n\t\tdata,\n\t\tsuccess: callback\n\t});\n};\n\n// -------------------------------------------------------------------------\n// Export\n// -------------------------------------------------------------------------\n\nexport default AnimeClient;","import _ from './anime-client.js';\n\n// ----------------------------------------------------------------------------\n// Event subscriptions\n// ----------------------------------------------------------------------------\n_.on('header', 'click', '.message', hide);\n_.on('form.js-delete', 'submit', confirmDelete);\n_.on('.js-clear-cache', 'click', clearAPICache);\n_.on('.vertical-tabs input', 'change', scrollToSection);\n_.on('.media-filter', 'input', filterMedia);\n\n// ----------------------------------------------------------------------------\n// Handler functions\n// ----------------------------------------------------------------------------\n\n/**\n * Hide the html element attached to the event\n *\n * @param {MouseEvent} event\n * @return void\n */\nfunction hide (event) {\n\t_.hide(event.target)\n}\n\n/**\n * Confirm deletion of an item\n *\n * @param {MouseEvent} event\n * @return void\n */\nfunction confirmDelete (event) {\n\tconst proceed = confirm('Are you ABSOLUTELY SURE you want to delete this item?');\n\n\tif (proceed === false) {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\t}\n}\n\n/**\n * Clear the API cache, and show a message if the cache is cleared\n *\n * @return void\n */\nfunction clearAPICache () {\n\t_.get('/cache_purge', () => {\n\t\t_.showMessage('success', 'Successfully purged api cache');\n\t});\n}\n\n/**\n * Scroll to the accordion/vertical tab section just opened\n *\n * @param {InputEvent} event\n * @return void\n */\nfunction scrollToSection (event) {\n\tconst el = event.currentTarget.parentElement;\n\tconst rect = el.getBoundingClientRect();\n\n\tconst top = rect.top + window.pageYOffset;\n\n\twindow.scrollTo({\n\t\ttop,\n\t\tbehavior: 'smooth',\n\t});\n}\n\n/**\n * Filter an anime or manga list\n *\n * @param {InputEvent} event\n * @return void\n */\nfunction filterMedia (event) {\n\tconst rawFilter = event.target.value;\n\tconst filter = new RegExp(rawFilter, 'i');\n\n\t// console.log('Filtering items by: ', filter);\n\n\tif (rawFilter !== '') {\n\t\t// Filter the cover view\n\t\t_.$('article.media').forEach(article => {\n\t\t\tconst titleLink = _.$('.name a', article)[0];\n\t\t\tconst title = String(titleLink.textContent).trim();\n\t\t\tif ( ! filter.test(title)) {\n\t\t\t\t_.hide(article);\n\t\t\t} else {\n\t\t\t\t_.show(article);\n\t\t\t}\n\t\t});\n\n\t\t// Filter the list view\n\t\t_.$('table.media-wrap tbody tr').forEach(tr => {\n\t\t\tconst titleCell = _.$('td.align-left', tr)[0];\n\t\t\tconst titleLink = _.$('a', titleCell)[0];\n\t\t\tconst linkTitle = String(titleLink.textContent).trim();\n\t\t\tconst textTitle = String(titleCell.textContent).trim();\n\t\t\tif ( ! (filter.test(linkTitle) || filter.test(textTitle))) {\n\t\t\t\t_.hide(tr);\n\t\t\t} else {\n\t\t\t\t_.show(tr);\n\t\t\t}\n\t\t});\n\t} else {\n\t\t_.show('article.media');\n\t\t_.show('table.media-wrap tbody tr');\n\t}\n}\n","import _ from './anime-client.js';\n\n(() => {\n\tlet hidden = null;\n\tlet visibilityChange = null;\n\n\tif (typeof document.hidden !== \"undefined\") {\n\t\thidden = \"hidden\";\n\t\tvisibilityChange = \"visibilitychange\";\n\t} else if (typeof document.msHidden !== \"undefined\") {\n\t\thidden = \"msHidden\";\n\t\tvisibilityChange = \"msvisibilitychange\";\n\t} else if (typeof document.webkitHidden !== \"undefined\") {\n\t\thidden = \"webkitHidden\";\n\t\tvisibilityChange = \"webkitvisibilitychange\";\n\t}\n\n\tfunction handleVisibilityChange() {\n\t\t// Check the user's session to see if they are currently logged-in\n\t\t// when the page becomes visible\n\t\tif ( ! document[hidden]) {\n\t\t\t_.get('/heartbeat', (beat) => {\n\t\t\t\tconst status = JSON.parse(beat)\n\n\t\t\t\t// If the session is expired, immediately reload so that\n\t\t\t\t// you can't attempt to do an action that requires authentication\n\t\t\t\tif (status.hasAuth !== true) {\n\t\t\t\t\tdocument.removeEventListener(visibilityChange, handleVisibilityChange, false);\n\t\t\t\t\tlocation.reload();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tif (hidden === null) {\n\t\tconsole.info('Page visibility API not supported, JS session check will not work');\n\t} else {\n\t\tdocument.addEventListener(visibilityChange, handleVisibilityChange, false);\n\t}\n})();","import _ from './anime-client.js';\n\n// Click on hidden MAL checkbox so\n// that MAL id is passed\n_.on('main', 'change', '.big-check', (e) => {\n\tconst id = e.target.id;\n\tdocument.getElementById(`mal_${id}`).checked = true;\n\tdocument.getElementById(`anilist_${id}`).checked = true;\n});\n\n/**\n * On search results with an existing library entry, this shows that fact, with an edit link for the existing\n * library entry\n *\n * @param {'anime'|'manga'} type\n * @param {Object} item\n * @param isCollection\n * @returns {String}\n */\nfunction renderEditLink (type, item, isCollection = false) {\n\tif (isCollection || item.libraryEntry === null) {\n\t\treturn '';\n\t}\n\n\treturn `\n\t\t<div class=\"row\">\n\t\t\t<span class=\"edit\"><big>[ Already in List ]</big></span>\n\t\t</div>\n\t\t<div class=\"row\">\n\t\t\t<span class=\"edit\">\n\t\t\t\t<a class=\"bracketed\" href=\"/${type}/edit/${item.libraryEntry.id}/${item.libraryEntry.status}\">Edit</a>\n\t\t\t</span>\n\t\t</div>\n\t\t<div class=\"row\"><span class=\"edit\">&nbsp;</span></div>\n\t`\n}\n\n/**\n * Show the search results for a media item\n *\n * @param {'anime'|'manga'} type\n * @param {Object} data\n * @param {boolean} isCollection\n * @returns {String}\n */\nexport function renderSearchResults (type, data, isCollection = false) {\n\treturn data.map(item => {\n\t\tconst titles = item.titles.join('<br />');\n\t\tlet disabled = item.libraryEntry !== null ? 'disabled' : '';\n\t\tconst editLink = renderEditLink(type, item, isCollection);\n\n\t\tif (isCollection) {\n\t\t\tdisabled = '';\n\t\t}\n\n\t\treturn `\n\t\t\t<article class=\"media search ${disabled}\">\n\t\t\t\t<div class=\"name\">\n\t\t\t\t\t<input type=\"radio\" class=\"mal-check\" id=\"anilist_${item.slug}\" name=\"anilist_id\" value=\"${item.anilist_id}\" ${disabled} />\n\t\t\t\t\t<input type=\"radio\" class=\"mal-check\" id=\"mal_${item.slug}\" name=\"mal_id\" value=\"${item.mal_id}\" ${disabled} />\n\t\t\t\t\t<input type=\"radio\" class=\"big-check\" id=\"${item.slug}\" name=\"id\" value=\"${item.id}\" ${disabled} />\n\t\t\t\t\t<label for=\"${item.slug}\">\n\t\t\t\t\t\t<img src=\"${item.coverImage}\" alt=\"\" width=\"220\" />\n\t\t\t\t\t\t<span class=\"name\">\n\t\t\t\t\t\t\t${item.canonicalTitle}<br />\n\t\t\t\t\t\t\t<small>${titles}</small>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"table\">\n\t\t\t\t\t${editLink}\n\t\t\t\t\t<div class=\"row\">\n\t\t\t\t\t\t<span class=\"edit\">\n\t\t\t\t\t\t\t<a class=\"bracketed\" href=\"/${type}/details/${item.slug}\">Info Page</a>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</article>\n\t\t`;\n\t}).join('');\n}","/**\n * Make sure properties are in an easily splittable format\n *\n * @private\n * @param {String} props\n * @param {String} [sep='.'] The default separator\n * @return {String}\n */\nfunction _normalizeProperty(props, sep = '.') {\n\t// Since we split by period, and property lookup\n\t// is the same by dot or [], replace bracket lookups\n\t// with periods\n\treturn props.replace(/\\[(.*?)]/g, sep + '$1');\n}\n\n/**\n * Tell if a nested object has a given property (or array a given index)\n * given an object such as a.b.c.d = 5, hasNestedProperty(a, 'b.c.d') will return true.\n *\n * @param {Object} object the object to get the property from\n * @param {String} property the path to the property as a string\n * @returns {boolean} true when property in object, false otherwise\n */\nexport function hasNestedProperty(object, property) {\n\tif (object && typeof object === 'object') {\n\t\tif (typeof property === 'string' && property !== '') {\n\t\t\tproperty = _normalizeProperty(property);\n\n\t\t\tlet split = property.split('.');\n\t\t\treturn split.reduce((obj, prop, idx, array) => {\n\t\t\t\tif (idx === array.length - 1) {\n\t\t\t\t\treturn !!(obj && obj.hasOwnProperty(prop));\n\t\t\t\t}\n\n\t\t\t\treturn obj && obj[prop];\n\t\t\t}, object);\n\t\t} else if (typeof property === 'number') {\n\t\t\treturn property in object;\n\t\t}\n\t}\n\n\treturn false;\n}\n\n/**\n * Get the value of a deeply nested property in an object\n *\n * @param {Object} object the object to get the property\n * @param {string} property the path to the property as a string\n * @param {string} [sep='.'] The default separator to split on\n * @return {*} the value of the property\n */\nexport function getNestedProperty(object, property, sep = '.') {\n\tif (isType('string', property) && property !== '') {\n\t\t// convert numbers to dot syntax\n\t\tproperty = _normalizeProperty(property, sep);\n\t\tconst levels = property.split(sep);\n\n\t\ttry {\n\t\t\treturn levels.reduce((obj, prop) => obj[prop], object);\n\t\t} catch (e) {\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\treturn null;\n}\n\n/**\n * Reliably get the type of the value of a variable\n *\n * @param {*} x The variable to get the type of\n * @return {string} The name of the type\n */\nexport function getType(x) {\n\t// is it an array?\n\tif (Array.isArray(x)) {\n\t\treturn 'array';\n\t}\n\n\t// Use typeof for truthy primitives\n\tif (typeof x !== 'object') {\n\t\treturn (typeof x).toLowerCase();\n\t}\n\n\tconst type = function () {\n\t\treturn Object.prototype.toString.call(this).slice(8, -1);\n\t}\n\n\t// Otherwise, strip the type out of the '[Object x]' toString value\n\treturn type.call(x).toLowerCase();\n}\n\n/**\n * Check whether the value matches the passed type name\n *\n * @param {string} type Javascript type name\n * @param {*} val The value to type check\n * @return {boolean}\n */\nexport function isType(type, val) {\n\treturn getType(val) === String(type).toLowerCase();\n}","import _ from './anime-client.js'\nimport { renderSearchResults } from './template-helpers.js'\nimport { getNestedProperty, hasNestedProperty } from \"./fns\";\n\nconst search = (query, isCollection = false) => {\n\t// Show the loader\n\t_.show('.cssload-loader');\n\n\t// Do the api search\n\treturn _.get(_.url('/anime-collection/search'), { query }, (searchResults, status) => {\n\t\tsearchResults = JSON.parse(searchResults);\n\n\t\t// Hide the loader\n\t\t_.hide('.cssload-loader');\n\n\t\t// Show the results\n\t\t_.$('#series-list')[ 0 ].innerHTML = renderSearchResults('anime', searchResults, isCollection);\n\t});\n};\n\n// Anime list search\nif (_.hasElement('.anime #search')) {\n\tlet prevRequest = null;\n\n\t_.on('#search', 'input', _.throttle(250, (e) => {\n\t\tconst query = encodeURIComponent(e.target.value);\n\t\tif (query === '') {\n\t\t\treturn;\n\t\t}\n\n\t\tif (prevRequest !== null) {\n\t\t\tprevRequest.abort();\n\t\t}\n\n\t\tprevRequest = search(query);\n\t}));\n}\n\n// Anime collection search\nif (_.hasElement('#search-anime-collection')) {\n\tlet prevRequest = null;\n\n\t_.on('#search-anime-collection', 'input', _.throttle(250, (e) => {\n\t\tconst query = encodeURIComponent(e.target.value);\n\t\tif (query === '') {\n\t\t\treturn;\n\t\t}\n\n\t\tif (prevRequest !== null) {\n\t\t\tprevRequest.abort();\n\t\t}\n\n\t\tprevRequest = search(query, true);\n\t}));\n}\n\n// Action to increment episode count\n_.on('body.anime.list', 'click', '.plus-one', (e) => {\n\tlet parentSel = _.closestParent(e.target, 'article');\n\tlet watchedCount = parseInt(_.$('.completed_number', parentSel)[ 0 ].textContent, 10) || 0;\n\tlet totalCount = parseInt(_.$('.total_number', parentSel)[ 0 ].textContent, 10);\n\tlet title = _.$('.name a', parentSel)[ 0 ].textContent;\n\n\t// Setup the update data\n\tlet data = {\n\t\tid: parentSel.dataset.kitsuId,\n\t\tanilist_id: parentSel.dataset.anilistId,\n\t\tmal_id: parentSel.dataset.malId,\n\t\tdata: {\n\t\t\tprogress: watchedCount + 1\n\t\t}\n\t};\n\n\tconst displayMessage = (type, message) => {\n\t\t_.hide('#loading-shadow');\n\t\t_.showMessage(type, `${message} ${title}`);\n\t\t_.scrollToTop();\n\t}\n\n\tconst showError = () => displayMessage('error', 'Failed to update');\n\n\t// If the episode count is 0, and incremented,\n\t// change status to currently watching\n\tif (isNaN(watchedCount) || watchedCount === 0) {\n\t\tdata.data.status = 'CURRENT';\n\t}\n\n\t// If you increment at the last episode, mark as completed\n\tif ((!isNaN(watchedCount)) && (watchedCount + 1) === totalCount) {\n\t\tdata.data.status = 'COMPLETED';\n\t}\n\n\t_.show('#loading-shadow');\n\n\t// okay, lets actually make some changes!\n\t_.ajax(_.url('/anime/increment'), {\n\t\tdata,\n\t\tdataType: 'json',\n\t\ttype: 'POST',\n\t\tsuccess: (res) => {\n\t\t\ttry {\n\t\t\t\tconst resData = JSON.parse(res);\n\n\t\t\t\t// Do a rough sanity check for weird errors\n\t\t\t\tlet updatedProgress = getNestedProperty(resData, 'data.libraryEntry.update.libraryEntry.progress');\n\t\t\t\tif (hasNestedProperty(resData, 'error') || updatedProgress !== data.data.progress) {\n\t\t\t\t\tshowError();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// We've completed the series\n\t\t\t\tif (getNestedProperty(resData, 'data.libraryEntry.update.libraryEntry.status') === 'COMPLETED') {\n\t\t\t\t\t_.hide(parentSel);\n\t\t\t\t\tdisplayMessage('success', 'Completed')\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Just a normal update\n\t\t\t\t_.$('.completed_number', parentSel)[ 0 ].textContent = ++watchedCount;\n\t\t\t\tdisplayMessage('success', 'Updated');\n\t\t\t} catch (_) {\n\t\t\t\tshowError();\n\t\t\t}\n\t\t},\n\t\terror: showError,\n\t});\n});","import _ from './anime-client.js'\nimport { renderSearchResults } from './template-helpers.js'\nimport { getNestedProperty, hasNestedProperty } from \"./fns\";\n\nconst search = (query) => {\n\t_.show('.cssload-loader');\n\treturn _.get(_.url('/manga/search'), { query }, (searchResults, status) => {\n\t\tsearchResults = JSON.parse(searchResults);\n\t\t_.hide('.cssload-loader');\n\t\t_.$('#series-list')[ 0 ].innerHTML = renderSearchResults('manga', searchResults);\n\t});\n};\n\nif (_.hasElement('.manga #search')) {\n\tlet prevRequest = null\n\n\t_.on('#search', 'input', _.throttle(250, (e) => {\n\t\tlet query = encodeURIComponent(e.target.value);\n\t\tif (query === '') {\n\t\t\treturn;\n\t\t}\n\n\t\tif (prevRequest !== null) {\n\t\t\tprevRequest.abort();\n\t\t}\n\n\t\tprevRequest = search(query);\n\t}));\n}\n\n/**\n * Javascript for editing manga, if logged in\n */\n_.on('.manga.list', 'click', '.edit-buttons button', (e) => {\n\tlet thisSel = e.target;\n\tlet parentSel = _.closestParent(e.target, 'article');\n\tlet type = thisSel.classList.contains('plus-one-chapter') ? 'chapter' : 'volume';\n\tlet completed = parseInt(_.$(`.${type}s_read`, parentSel)[ 0 ].textContent, 10) || 0;\n\tlet total = parseInt(_.$(`.${type}_count`, parentSel)[ 0 ].textContent, 10);\n\tlet title = _.$('.name', parentSel)[ 0 ].textContent;\n\n\tif (isNaN(completed)) {\n\t\tcompleted = 0;\n\t}\n\n\t// Setup the update data\n\tlet data = {\n\t\tid: parentSel.dataset.kitsuId,\n\t\tanilist_id: parentSel.dataset.anilistId,\n\t\tmal_id: parentSel.dataset.malId,\n\t\tdata: {\n\t\t\tprogress: completed\n\t\t}\n\t};\n\n\tconst displayMessage = (type, message) => {\n\t\t_.hide('#loading-shadow');\n\t\t_.showMessage(type, `${message} ${title}`);\n\t\t_.scrollToTop();\n\t}\n\n\tconst showError = () => displayMessage('error', 'Failed to update');\n\n\t// If the episode count is 0, and incremented,\n\t// change status to currently reading\n\tif (isNaN(completed) || completed === 0) {\n\t\tdata.data.status = 'CURRENT';\n\t}\n\n\t// If you increment at the last chapter, mark as completed\n\tif ((!isNaN(completed)) && (completed + 1) === total) {\n\t\tdata.data.status = 'COMPLETED';\n\t}\n\n\t// Update the total count\n\tdata.data.progress = ++completed;\n\n\t_.show('#loading-shadow');\n\n\t_.ajax(_.url('/manga/increment'), {\n\t\tdata,\n\t\tdataType: 'json',\n\t\ttype: 'POST',\n\t\tmimeType: 'application/json',\n\t\tsuccess: (res) => {\n\t\t\ttry {\n\t\t\t\tconst resData = JSON.parse(res);\n\n\t\t\t\t// Do a rough sanity check for weird errors\n\t\t\t\tlet updatedProgress = getNestedProperty(resData, 'data.libraryEntry.update.libraryEntry.progress');\n\t\t\t\tif (hasNestedProperty(resData, 'error') || updatedProgress !== data.data.progress) {\n\t\t\t\t\tshowError();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// We've completed the series\n\t\t\t\tif (getNestedProperty(resData, 'data.libraryEntry.update.libraryEntry.status') === 'COMPLETED') {\n\t\t\t\t\t_.hide(parentSel);\n\t\t\t\t\tdisplayMessage('success', 'Completed')\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Just a normal update\n\t\t\t\t_.$(`.${type}s_read`, parentSel)[ 0 ].textContent = String(completed);\n\t\t\t\tdisplayMessage('success', 'Updated');\n\n\t\t\t} catch (_) {\n\t\t\t\tshowError();\n\t\t\t}\n\t\t},\n\t\terror: showError,\n\t});\n});"],"names":[],"mappings":"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"}